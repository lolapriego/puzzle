package controller;

import model.Metronomo;
import javax.swing.JFrame;
import view.SlidePuzzleGUI;
import java.util.Scanner;
import model.Puzzle;
import java.io.*;
import model.Partida;



/*
 * FramePartida.java
 * Ventana que mostrará la vista e interactuará con el modelo
 * and open the template in the editor.
 * Lee de un fichero llamado "fichero.txt" de la raíz del proyecto la primera línea para la primera jugada,
 * sino crea uno por defecto
 * 
 * Inicializa los contenidos de la ventana así como el thread Metronomo
 * Asigna el timer mediante el Slider ¡Antes de comenzar la partida!
 *
 * @author Mª Dolores Priego Porcuna y Daniel Caballero Bellot
 * https://github.com/lolapriego/puzzle
 *
 * @version Created on Apr 22, 2012, 4:10:01 PM
 */

public class FramePartida extends javax.swing.JFrame {
   public static int estado;
   public static double timer;

public static void main(String[] args) {
       Scanner lector= new Scanner(System.in);
       int contador=0;
       Puzzle puzzle = leerPuzzle(contador);
       contador++;
       Partida partida = new Partida(puzzle);
       estado = 0;


        JFrame window = new JFrame("Slide Puzzle");
        window.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        StatusAction listenerState = new StatusAction();
        StartAction ngl = new StartAction();
        TimerAction timerAct = new TimerAction();

        SlidePuzzleGUI gui = new SlidePuzzleGUI(puzzle, listenerState, ngl, timerAct);
        window.setContentPane(gui);
        window.pack();  // finalize layout
        window.show();  // make window visible
        window.setResizable(false);
        Metronomo m1 = new Metronomo (timerAct.getTimer());
        if (partida.partidaResuelta())
        m1.addMetronomoListener(new TicMetronomo(partida.getTraza(),gui, listenerState, ngl));
    }//end main
   
    // <editor-fold defaultstate="collapsed" desc="Generated Code">
    private void initComponents() {

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Me cago en la puta");
        setBackground(new java.awt.Color(0, 153, 255));

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(0, 1336, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(0, 434, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>

    // Variables declaration - do not modify
    // End of variables declaration

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
   /* @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Me cago en la puta");
        setBackground(new java.awt.Color(0, 153, 255));

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(0, 1336, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(0, 434, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    // Variables declaration - do not modify//GEN-BEGIN:variables
    // End of variables declaration//GEN-END:variables
 */
     private static Puzzle leerPuzzle (int contador){
         Puzzle puzzle= new Puzzle();

          try{
       puzzle = new Puzzle("1 2345",3, 2);
       BufferedReader lector= new BufferedReader(new FileReader("fichero.txt"));

       for(int i=0;i< contador;i++)
       lector.readLine();
       String linea=lector.readLine();
       System.out.println("La cadena le�da de fichero es: " + linea + "    \nlos �ltimos datos son considerados como las filas y columnas");
       System.out.println("�sta genera el siguiente puzzle: ");
       int aux=linea.length()-1;
       puzzle = new Puzzle(linea.substring(0,aux-1),linea.charAt(aux-1)-'0',linea.charAt(aux)-'0');
       System.out.println(puzzle.toString());
       lector.close();

    }
       catch (Exception e){// ver si manejarlo de otra forma
           System.out.println(e);
        }
           return puzzle;
    }

}
